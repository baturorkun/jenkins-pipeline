#!/usr/bin/env bash

buildImage() {
    local registry=$1
    local imageName=$2
    local version=$3
    local options=$4
    (
        # Run in sub shell so directory change does not affect caller
        cd "docker/${imageName}"
        docker build --pull ${options} -t ${registry#docker.io/}/${imageName}:${version} . || { >&2 echo "Failed to build image ${imageName}"; return 1; }
    )
}

pushImage() {
    local registry=$1
    local imageName=$2
    local version=$3
    local username=$4
    local password=$5
    docker login ${registry/docker.io\/*/} -u "${username}" -p "${password}" || { >&2 echo "Failed to login to registry for pushing image ${imageName}"; return 1; }
    docker push ${registry#docker.io/}/${imageName}:${version} || { >&2 echo "Failed to push image ${imageName}"; return 1; }
    docker logout ${registry/docker.io\/*/}; return 0
}

removeImage() {
    local registry=$1
    local imageName=$2
    local version=$3
    docker rmi ${registry#docker.io/}/${imageName}:${version} || { >&2 echo "Failed to remove image ${imageName}"; return 1; }
}
